name: Setup Dioxus
description: Setup Dioxus environment with dependencies and database configuration

runs:
    using: composite
    steps:
        - uses: actions/cache@v4
          with:
              path: |
                  ~/.cargo/
                  ~/.dioxus/
                  ~/.rustup/
                  target/
              key: ${{ runner.os }}-cargo-{{ hashFiles('**/Cargo.lock') }}
        - uses: cargo-bins/cargo-binstall@main
        - uses: awalsh128/cache-apt-pkgs-action@latest
          with:
              packages: |
                  libwebkit2gtk-4.1-dev build-essential curl wget file libxdo-dev libssl-dev libayatana-appindicator3-dev librsvg2-dev
                  fonts-freefont-ttf fonts-ipafont-gothic fonts-tlwg-loma-otf fonts-unifont fonts-wqy-zenhei xfonts-cyrillic
                  xfonts-encodings xfonts-scalable xfonts-utils
              version: 1.0
              execute_install_scripts: true
        - name: Install Dioxus CLI & SQLx CLI
          shell: bash
          run: cargo binstall -y dioxus-cli@0.7.2 sqlx-cli@0.8.6
        - name: Add additional Rustup targets
          shell: bash
          run: rustup target add wasm32-unknown-unknown aarch64-linux-android armv7-linux-androideabi i686-linux-android x86_64-linux-android
        - name: Run database migrations
          shell: bash
          run: sqlx database setup
        - shell: bash
          run: touch app/assets/style.css
